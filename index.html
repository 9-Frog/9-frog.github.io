<div id="tarot-app"></div>

<style>
  html, body { background:#f9d5d3; margin:0; padding:0; }
  #tarot-app {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    max-width: 960px; margin: 28px auto; padding: 20px;
    background: rgba(255,255,255,0.9); border-radius: 16px;
    box-shadow: 0 10px 24px rgba(0,0,0,.12); backdrop-filter: blur(4px);
  }
  h1 { margin:0 0 12px; font-size:24px; color:#222; }
  .muted { color:#555; font-size:14px; }
  .section{ margin-top:14px; }

  .row { display:grid; gap:10px; grid-template-columns: 1fr; }
  @media (min-width:900px){ .row-3 { grid-template-columns: 1fr 1fr 1fr; } }
  @media (min-width:700px){ .row-2 { grid-template-columns: 1fr 1fr; } }

  input, select, textarea {
    width:100%; padding:12px 14px; font-size:15px;
    border:1px solid #ddd; border-radius:12px; background:#fff;
    box-shadow: inset 0 1px 2px rgba(0,0,0,.05);
    outline:none;
  }
  textarea { min-height:88px; resize:vertical; }

  .btn {
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 16px; border:none; border-radius:12px;
    background:#111; color:#fff; font-weight:700; cursor:pointer;
    transition:.15s transform, .2s box-shadow, .2s background;
  }
  .btn:hover { transform: translateY(-1px); }
  .btn[disabled]{ opacity:.5; cursor:not-allowed; }

  .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef2ff; color:#3b49df; font-size:12px; font-weight:700; }

  .decks { display:grid; grid-template-columns: repeat(auto-fit, minmax(120px,1fr)); gap:12px; margin-top:12px; }
  .deck {
    background:#fff; border:1px solid #eee; border-radius:14px; padding:18px; text-align:center;
    box-shadow:0 4px 12px rgba(0,0,0,.08); cursor:pointer; transition:.16s transform,.2s box-shadow;
  }
  .deck:hover { transform: translateY(-2px); box-shadow: 0 8px 22px rgba(0,0,0,.12); }

  .cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(100px,1fr)); gap:12px; margin-top:12px; }

  /* Flip - opaklƒ±k */
  .card {
    position:relative; aspect-ratio:2/3; border-radius:12px; overflow:hidden;
    cursor:pointer; border:1px solid #e9e9e9; background:#eee; 
    box-shadow:0 6px 16px rgba(0,0,0,.1);
  }
  .face, .back { position:absolute; inset:0; border-radius:12px; transition: opacity .35s ease; }
  .back { opacity:1; background-size:cover; background-position:center; background-repeat:no-repeat; }
  .face { opacity:0; }
  .card.flipped .back { opacity:0; }
  .card.flipped .face { opacity:1; }

  .face img { width:100%; height:100%; object-fit:contain; object-position:center; display:block; border-radius:12px; background:#fff; }

  .sel-badge { position:absolute; bottom:6px; left:6px; background:#111; color:#fff; font-size:11px; font-weight:700; padding:4px 8px; border-radius:8px; }

  .reading { margin-top:16px; padding:16px; background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:0 6px 16px rgba(0,0,0,.08); }
  .reading .item { background:#fdf1f1; border:1px solid #fde1e1; border-radius:12px; padding:12px; margin-top:10px; }
  .meta { color:#666; font-size:12px; margin-bottom:6px; }

  .final-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:14px; margin-top:12px; }
  .final-card { border:1px solid #eee; border-radius:14px; overflow:hidden; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,.08); }
  .final-card .img { aspect-ratio:2/3; background:#fafafa; }
  .final-card .img img { width:100%; height:100%; object-fit:contain; display:block; background:#fff; }
  .final-card .cap { padding:8px 10px; font-size:13px; color:#444; }
</style>

<script>
(function(){
  /* === G√∂rseller === */
  const CARD_BACK_IMAGE_URL = "https://steve-p.org/cards/pix/RWSa-X-BA.png";

  const CARD_IMAGES = {
    "The Fool":"https://steve-p.org/cards/pix/RWSa-T-00.png","The Magician":"https://steve-p.org/cards/pix/RWSa-T-01.png","The High Priestess":"https://steve-p.org/cards/pix/RWSa-T-02.png","The Empress":"https://steve-p.org/cards/pix/RWSa-T-03.png","The Emperor":"https://steve-p.org/cards/pix/RWSa-T-04.png","The Hierophant":"https://steve-p.org/cards/pix/RWSa-T-05.png","The Lovers":"https://steve-p.org/cards/pix/RWSa-T-06.png","The Chariot":"https://steve-p.org/cards/pix/RWSa-T-07.png","Strength":"https://steve-p.org/cards/pix/RWSa-T-08.png","The Hermit":"https://steve-p.org/cards/pix/RWSa-T-09.png","Wheel of Fortune":"https://steve-p.org/cards/pix/RWSa-T-10.png","Justice":"https://steve-p.org/cards/pix/RWSa-T-11.png","The Hanged Man":"https://steve-p.org/cards/pix/RWSa-T-12.png","Death":"https://steve-p.org/cards/pix/RWSa-T-13.png","Temperance":"https://steve-p.org/cards/pix/RWSa-T-14.png","The Devil":"https://steve-p.org/cards/pix/RWSa-T-15.png","The Tower":"https://steve-p.org/cards/pix/RWSa-T-16.png","The Star":"https://steve-p.org/cards/pix/RWSa-T-17.png","The Moon":"https://steve-p.org/cards/pix/RWSa-T-18.png","The Sun":"https://steve-p.org/cards/pix/RWSa-T-19.png","Judgement":"https://steve-p.org/cards/pix/RWSa-T-20.png","The World":"https://steve-p.org/cards/pix/RWSa-T-21.png",
    "Ace of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-0A.webp","Two of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-02.webp","Three of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-03.webp","Four of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-04.webp","Five of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-05.webp","Six of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-06.webp","Seven of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-07.webp","Eight of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-08.webp","Nine of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-09.webp","Ten of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-10.webp","Page of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-J1.webp","Knight of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-J2.webp","Queen of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-QU.webp","King of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-KI.webp",
    "Ace of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-0A.webp","Two of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-02.webp","Three of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-03.webp","Four of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-04.webp","Five of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-05.webp","Six of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-06.webp","Seven of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-07.webp","Eight of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-08.webp","Nine of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-09.webp","Ten of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-10.webp","Page of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-J1.webp","Knight of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-J2.webp","Queen of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-QU.webp","King of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-KI.webp",
    "Ace of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-0A.webp","Two of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-02.webp","Three of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-03.webp","Four of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-04.webp","Five of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-05.webp","Six of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-06.webp","Seven of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-07.webp","Eight of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-08.webp","Nine of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-09.webp","Ten of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-10.webp","Page of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-J1.webp","Knight of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-J2.webp","Queen of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-QU.webp","King of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-KI.webp",
    "Ace of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-0A.png","Two of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-02.png","Three of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-03.png","Four of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-04.png","Five of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-05.png","Six of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-06.png","Seven of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-07.png","Eight of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-08.png","Nine of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-09.png","Ten of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-10.png","Page of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-J1.webp","Knight of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-J2.webp","Queen of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-QU.webp","King of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-KI.webp"
  };

  const DEFAULT_BACK = `data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 450'>
  <defs>
    <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#f9d5d3'/>
      <stop offset='100%' stop-color='#fbe8e6'/>
    </linearGradient>
    <pattern id='p' width='20' height='20' patternUnits='userSpaceOnUse'>
      <circle cx='10' cy='10' r='2' fill='#f3b6b3' opacity='0.6'/>
    </pattern>
  </defs>
  <rect width='100%' height='100%' fill='url(#g)'/>
  <rect width='100%' height='100%' fill='url(#p)'/>
</svg>`;

  const backUrl = () => (CARD_BACK_IMAGE_URL && CARD_BACK_IMAGE_URL.trim()) ? CARD_BACK_IMAGE_URL : DEFAULT_BACK;
  const faceUrlFor = (cardName) => {
    const u = CARD_IMAGES[cardName];
    return (u && typeof u === 'string' && u.trim()) ? u : backUrl();
  };

  /* === Tarot verileri === */
  const MAJOR = ['The Fool','The Magician','The High Priestess','The Empress','The Emperor','The Hierophant','The Lovers','The Chariot','Strength','The Hermit','Wheel of Fortune','Justice','The Hanged Man','Death','Temperance','The Devil','The Tower','The Star','The Moon','The Sun','Judgement','The World'];
  const SUITS = ['Wands','Cups','Swords','Pentacles'];
  const RANKS = ['Ace','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Page','Knight','Queen','King'];
  const MINOR = SUITS.flatMap(suit => RANKS.map(rank => `${rank} of ${suit}`));
  const ALL_CARDS = [...MAJOR, ...MINOR].map((name,idx)=>({id:idx,name}));

  /* Evet/Hayƒ±r (tek kart) */
  const YESNO = { "The Sun":"yes","The Lovers":"yes","The World":"yes","The Tower":"no","Death":"no","The Devil":"no" };
  const suitOf = n => SUITS.find(s=>n.includes(` of ${s}`));
  const defaultYesNo = n => suitOf(n)==="Swords"?"no": suitOf(n)==="Cups"?"maybe":"yes";

  const positions = {
    three: ['Ge√ßmi≈ü','≈ûimdi','Gelecek'],
    five: ['Ge√ßmi≈ü','≈ûimdi','Gizli Etkiler','Engeller/Zorluklar','Gelecek'],
    cross: ['≈ûimdiki Durum','Engeller/Zorluklar','Bilin√ßli Farkƒ±ndalƒ±k','Bilin√ßaltƒ±/Temel','Ge√ßmi≈ü','Gelecek','Sen','Kar≈üƒ± Taraf','Umutlar/Korkular','Sonu√ß'],
    relationship: ['Senin Duygularƒ±n','Onun Duygularƒ±','Senin D√º≈ü√ºncelerin','Onun D√º≈ü√ºnceleri','Aranƒ±zdaki Baƒü','Engeller/Sorunlar','Gelecek Olasƒ± Sonu√ß']
  };

  /* === State === */
  const state = {
    name: "", mode: null, category: null, yesnoQuestion: "",
    decksMeta: null, chosenDeckIndex: null, needSelect: 0, selectedCards: [],
    commentSize: "medium" // short | medium | long
  };

  const root = document.getElementById('tarot-app');
  render();

  function render(){
    if (state.selectedCards.length && state.selectedCards.length === state.needSelect) return renderFinal();

    root.innerHTML = `
      <h1>üîÆ Online Tarot</h1>
      <div class="muted">ƒ∞smini, a√ßƒ±lƒ±mƒ± ve <b>yorum boyutunu</b> se√ß. Tek Kart‚Äôta evet/hayƒ±r sorununu yazmayƒ± unutma.</div>
    `;

    const step1 = document.createElement('div'); step1.className='section';
    step1.innerHTML = `
      <div class="row row-3">
        <div>
          <label class="muted">ƒ∞smin</label>
          <input id="inp-name" type="text" placeholder="ƒ∞smini yaz" value="${escapeHtml(state.name)}">
        </div>
        <div>
          <label class="muted">A√ßƒ±lƒ±m T√ºr√º</label>
          <select id="sel-mode">
            <option value="">Se√ßiniz‚Ä¶</option>
            <option value="one" ${state.mode==='one'?'selected':''}>Tek Kart</option>
            <option value="three" ${state.mode==='three'?'selected':''}>3 Kart</option>
            <option value="five" ${state.mode==='five'?'selected':''}>5 Kart</option>
            <option value="cross" ${state.mode==='cross'?'selected':''}>Ha√ß A√ßƒ±lƒ±mƒ±</option>
            <option value="relationship" ${state.mode==='relationship'?'selected':''}>ƒ∞li≈üki A√ßƒ±lƒ±mƒ±</option>
          </select>
        </div>
        <div>
          <label class="muted">Yorum Boyutu</label>
          <select id="sel-size">
            <option value="short"  ${state.commentSize==='short'?'selected':''}>Kƒ±sa</option>
            <option value="medium" ${state.commentSize==='medium'?'selected':''}>Orta</option>
            <option value="long"   ${state.commentSize==='long'?'selected':''}>Uzun</option>
          </select>
        </div>
      </div>
    `;
    root.appendChild(step1);

    if(state.mode === 'one'){
      const step2 = document.createElement('div'); step2.className='section';
      step2.innerHTML = `
        <label class="muted">Evet / Hayƒ±r Sorun</label>
        <textarea id="inp-yn" placeholder="√ñrn: Bug√ºnk√º g√∂r√º≈ümem olumlu ge√ßer mi?">${escapeHtml(state.yesnoQuestion)}</textarea>
      `;
      root.appendChild(step2);
    } else if(state.mode){
      const step2 = document.createElement('div'); step2.className='section';
      step2.innerHTML = `
        <label class="muted">Kategori</label>
        <select id="sel-cat">
          <option value="">Se√ßiniz‚Ä¶</option>
          <option value="A≈ük" ${state.category==='A≈ük'?'selected':''}>A≈ük</option>
          <option value="Kariyer/Para" ${state.category==='Kariyer/Para'?'selected':''}>Kariyer/Para</option>
          <option value="Genel Durum" ${state.category==='Genel Durum'?'selected':''}>Genel Durum</option>
        </select>
      `;
      root.appendChild(step2);
    }

    const canBuild = state.name && state.mode && (state.mode==='one' || !!state.category);
    const step3 = document.createElement('div'); step3.className='section';
    step3.innerHTML = `
      <button id="btn-decks" class="btn" ${!canBuild?'disabled':''}>Desteleri Olu≈ütur</button>
      ${state.decksMeta ? '<span class="pill" style="margin-left:8px;">Hazƒ±r</span>':''}
    `;
    root.appendChild(step3);

    if(state.decksMeta){
      if(state.chosenDeckIndex === null){
        const decksWrap = document.createElement('div'); decksWrap.className='section';
        decksWrap.innerHTML = `<div class="decks"></div>`;
        const decksEl = decksWrap.querySelector('.decks');
        state.decksMeta.decks.forEach((deck, i)=>{
          const d = document.createElement('div'); d.className='deck';
          d.innerHTML = `üÉè Deste ${i+1}<div class="muted">${deck.length} kart</div>`;
          d.addEventListener('click', ()=>{
            state.chosenDeckIndex = i;
            state.needSelect = requiredCount(state.mode);
            state.selectedCards = [];
            render();
          });
          decksEl.appendChild(d);
        });
        root.appendChild(decksWrap);
      } else {
        const deck = state.decksMeta.decks[state.chosenDeckIndex];
        const picked = state.selectedCards.length;
        const cardsWrap = document.createElement('div'); cardsWrap.className='section';
        cardsWrap.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
            <span class="pill">Deste ${state.chosenDeckIndex+1}</span>
            <span class="muted">Se√ßilecek: <b>${state.needSelect}</b> ‚Ä¢ Se√ßilen: <b>${picked}</b></span>
            <div style="flex:1"></div>
            <button id="btn-change-deck" class="btn" style="background:#555">Desteyi Deƒüi≈ütir</button>
          </div>
          <div class="cards" id="cards-grid"></div>
        `;
        root.appendChild(cardsWrap);

        const grid = cardsWrap.querySelector('#cards-grid');
        deck.forEach(cardId=>{
          const cardData = ALL_CARDS[cardId];
          const c = document.createElement('div'); c.className='card'; c.setAttribute('role','button');

          const back = document.createElement('div'); back.className='back'; back.style.backgroundImage = `url('${backUrl()}')`;
          const face = document.createElement('div'); face.className='face';
          const faceImg = document.createElement('img');
          faceImg.alt = cardData.name; faceImg.decoding='async'; faceImg.loading='lazy'; faceImg.referrerPolicy='no-referrer';
          faceImg.src = faceUrlFor(cardData.name);
          faceImg.onerror = ()=>{ faceImg.src = backUrl(); };
          face.appendChild(faceImg);

          c.appendChild(back); c.appendChild(face);

          c.addEventListener('click', ()=>{
            if(c.classList.contains('flipped')) return;
            if(state.selectedCards.length >= state.needSelect) return;
            c.classList.add('flipped');
            c.insertAdjacentHTML('beforeend', `<div class="sel-badge">#${state.selectedCards.length+1}</div>`);
            state.selectedCards.push({ id: cardId, name: cardData.name });
            if(state.selectedCards.length === state.needSelect){
              setTimeout(render, 350);
            }
          });
          grid.appendChild(c);
        });

        cardsWrap.querySelector('#btn-change-deck').addEventListener('click', ()=>{
          state.chosenDeckIndex = null;
          state.selectedCards = [];
          render();
        });
      }
    }

    const nameEl = document.getElementById('inp-name');
    const modeEl = document.getElementById('sel-mode');
    const catEl  = document.getElementById('sel-cat');
    const ynEl   = document.getElementById('inp-yn');
    const sizeEl = document.getElementById('sel-size');
    const decksBtn = document.getElementById('btn-decks');

    if(nameEl) nameEl.addEventListener('input', e=>{ state.name = e.target.value.trim(); });
    if(modeEl) modeEl.addEventListener('change', e=>{
      state.mode = e.target.value || null;
      state.category = null; state.yesnoQuestion=''; state.decksMeta=null; state.chosenDeckIndex=null; state.selectedCards=[]; state.needSelect=0;
      render();
    });
    if(sizeEl) sizeEl.addEventListener('change', e=>{ state.commentSize = e.target.value || 'medium'; });
    if(catEl)  catEl.addEventListener('change', e=>{ state.category = e.target.value || null; render(); });
    if(ynEl)   ynEl.addEventListener('input', e=>{ state.yesnoQuestion = e.target.value; });

    if(decksBtn) decksBtn.addEventListener('click', ()=>{
      if(!canBuildNow()) return;
      state.decksMeta = buildDecks(state.mode);
      state.chosenDeckIndex = null; state.selectedCards=[]; state.needSelect = requiredCount(state.mode);
      render();
    });

    function canBuildNow(){ return state.name && state.mode && (state.mode==='one' || !!state.category); }
  }

  function renderFinal(){
    const pos = positions[state.mode] || [];
    const title = state.mode==='one' ? 'Tek Kart' :
                  state.mode==='three' ? '3 Kart' :
                  state.mode==='five' ? '5 Kart' :
                  state.mode==='cross' ? 'Ha√ß A√ßƒ±lƒ±mƒ±' : 'ƒ∞li≈üki A√ßƒ±lƒ±mƒ±';

    const header = `
      <h1>üîÆ Online Tarot ‚Ä¢ ${title}</h1>
      <div class="muted">${escapeHtml(state.name)}${state.category ? ' ‚Ä¢ Kategori: '+escapeHtml(state.category): ''} ‚Ä¢ Yorum: ${sizeLabel(state.commentSize)}</div>
    `;

    const gridCards = state.selectedCards.map((c,i)=>`
      <div class="final-card">
        <div class="img"><img src="${faceUrlFor(c.name)}" alt="${escapeHtml(c.name)}" referrerpolicy="no-referrer" onerror="this.src='${backUrl()}'"></div>
        <div class="cap"><b>${pos[i] ? pos[i]+': ' : ''}${escapeHtml(c.name)}</b></div>
      </div>
    `).join('');

    let readingHtml = '';
    if(state.mode === 'one'){
      const c = state.selectedCards[0];
      const yn = (YESNO[c.name] || defaultYesNo(c.name)).toUpperCase();
      readingHtml += `
        <div class="item">
          <div class="meta">Soru: <b>${escapeHtml(state.yesnoQuestion||'‚Äî')}</b> ‚Ä¢ Yanƒ±t eƒüilimi: <b>${yn}</b></div>
          ${interpretCard(c.name, state.category || "Genel Durum", 'Tek Kart', state.commentSize, state.name)}
        </div>`;
    } else {
      state.selectedCards.forEach((c,i)=>{
        readingHtml += `
          <div class="item">
            <div class="meta">${pos[i]||('Kart '+(i+1))}</div>
            <b>${escapeHtml(c.name)}</b>
            <div style="margin-top:6px;">${interpretCard(c.name, state.category || "Genel Durum", pos[i]||null, state.commentSize, state.name)}</div>
          </div>`;
      });
    }

    root.innerHTML = `
      ${header}
      <div class="final-grid">${gridCards}</div>
      <div class="reading">
        <h3>üßø Yorum</h3>
        ${readingHtml}
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn" id="btn-again">Yeniden Dene</button>
        </div>
      </div>
    `;

    document.getElementById('btn-again').addEventListener('click', ()=>{ resetAll(); render(); });
  }

  /* === YORUM VERƒ∞TABANI (Major √∂zg√ºl; Minor ≈üablon) === */
  const majorMap = {
    "The Fool": {
      "A≈ük":"Kalbin yeni bir maceraya hazƒ±r; korkusuz fakat saygƒ±lƒ± adƒ±mlar taze bir romantizmi √ßaƒüƒ±rƒ±r.",
      "Kariyer/Para":"Giri≈üim kƒ±vƒ±lcƒ±mƒ±; hesaplƒ± risk ve √∂ƒürenme hevesi g√∂r√ºn√ºrl√ºƒü√ºn√º y√ºkseltir.",
      "Genel Durum":"Hayat ‚Äòdeneyimle‚Äô diyor; i√ß √ßocuƒüunun merakƒ±yla ilerlediƒüinde yol y√ºr√ºrken a√ßƒ±lƒ±r."
    },
    "The Magician": {
      "A≈ük":"ƒ∞fade g√ºc√ºn y√ºksek; net talep ve a√ßƒ±k kalp ili≈ükide sihir yaratƒ±r.",
      "Kariyer/Para":"Kaynak ve beceri sende; tek hedefe odaklan, fƒ±rsat kapƒ±sƒ± aralanƒ±yor.",
      "Genel Durum":"Niyet‚Äìs√∂z‚Äìeylem hizasƒ±; uyumlandƒ±ƒüƒ±nda kapƒ±lar kendiliƒüinden a√ßƒ±lƒ±r."
    },
    "The High Priestess": {
      "A≈ük":"Sessizlikte cevap var; sezgini dinle, acele etmeyerek kazanƒ±rsƒ±n.",
      "Kariyer/Para":"Perde arkasƒ±nƒ± oku; veri+sezgi doƒüru zamanƒ± i≈üaret ediyor.",
      "Genel Durum":"R√ºyalar ve i≈üaretler g√º√ßl√º; i√ß sesin bug√ºn pusulan."
    },
    "The Empress": {
      "A≈ük":"≈ûefkat ve sƒ±caklƒ±k baƒüƒ± b√ºy√ºt√ºr; birlikte alanƒ± g√ºzelle≈ütirmek yakƒ±nlƒ±ƒüƒ± artƒ±rƒ±r.",
      "Kariyer/Para":"Besleyen ritim bereket getirir; √ºretkenlik kalƒ±cƒ± olur.",
      "Genel Durum":"Doƒüayla temas ve yaratƒ±m; √ßoƒüalma enerjisi y√ºksek."
    },
    "The Emperor": {
      "A≈ük":"Saƒülƒ±klƒ± sƒ±nƒ±rlar yakƒ±nlƒ±ƒüƒ± korur; net √ßer√ßeve g√ºvendir.",
      "Kariyer/Para":"Plan‚Äìtakvim‚Äìsorumluluk; strateji otoriteyi peki≈ütirir.",
      "Genel Durum":"Kontrol edebildiƒüine odaklan; saƒülam temel her ≈üeyi ta≈üƒ±r."
    },
    "The Hierophant": {
      "A≈ük":"Rit√ºel ve deƒüerler baƒüa derinlik katar.",
      "Kariyer/Para":"Usta‚Äì√ßƒ±rak modeli hƒ±zlandƒ±rƒ±r; etik duru≈ü kazandƒ±rƒ±r.",
      "Genel Durum":"Gelenek ve bilgelik omurga saƒülar."
    },
    "The Lovers": {
      "A≈ük":"Kalp uyumu ve se√ßim; a√ßƒ±k konu≈üma baƒüa ƒ±≈üƒ±k tutar.",
      "Kariyer/Para":"Deƒüer uyumlu karar uzun vadeli tatmin getirir.",
      "Genel Durum":"Evetlerin ve hayƒ±rlarƒ±n seni tanƒ±mlar; b√ºt√ºnl√ºk pusulan."
    },
    "The Chariot": {
      "A≈ük":"Aynƒ± y√∂ne bakan iki y√ºreƒüe ivme; ortak hedef konu≈ümalarƒ± baƒülar.",
      "Kariyer/Para":"Daƒüƒ±lma; tek hedefe kilitlen, disiplin sonucu getirir.",
      "Genel Durum":"ƒ∞rade rotadƒ±r; ba≈ülangƒ±√ß niyetini hatƒ±rla ve s√ºrd√ºr."
    },
    "Strength": {
      "A≈ük":"Yumu≈üak cesaret savunmayƒ± indirir; yakƒ±nlƒ±k derinle≈üir.",
      "Kariyer/Para":"S√ºreklilik ve √∂z-disiplin uzun vadede kazanƒ±r.",
      "Genel Durum":"Nazik g√º√ß gerilimi eritir; kendine iyi davran."
    },
    "The Hermit": {
      "A≈ük":"Kƒ±sa geri √ßekili≈ü duyguyu berrakla≈ütƒ±rƒ±r.",
      "Kariyer/Para":"Stratejik yalnƒ±zlƒ±k odak kazandƒ±rƒ±r.",
      "Genel Durum":"ƒ∞√ß fenerini izle; dƒ±≈ü tabela gereksiz."
    },
    "Wheel of Fortune": {
      "A≈ük":"Zamanlama oyunu; dalganƒ±n ritmine uyum.",
      "Kariyer/Para":"Esneklik fƒ±rsatƒ± b√ºy√ºt√ºr; r√ºzg√¢r arkanda.",
      "Genel Durum":"D√∂ng√ºsel akƒ±≈üta ≈üans g√∂r√ºn√ºr olur."
    },
    "Justice": {
      "A≈ük":"E≈üit emek ve d√ºr√ºstl√ºk g√ºveni tazeler.",
      "Kariyer/Para":"≈ûeffaf kayƒ±t ve s√∂zle≈üme riski azaltƒ±r.",
      "Genel Durum":"Terazi denge ister; adil karar huzur getirir."
    },
    "The Hanged Man": {
      "A≈ük":"Onun penceresinden bakmak sihirlidir.",
      "Kariyer/Para":"Bekleme stratejiktir; yeniden √ßer√ßevele.",
      "Genel Durum":"Teslimiyet yaratƒ±cƒ± bo≈üluk a√ßar."
    },
    "Death": {
      "A≈ük":"Eski kalƒ±bƒ± bƒ±rak; baƒü tazelensin.",
      "Kariyer/Para":"Hizmet etmeyeni kapat, kaynaklarƒ±nƒ± yeniye y√∂nelt.",
      "Genel Durum":"D√∂n√º≈ü√ºm ka√ßƒ±nƒ±lmaz; hafifle."
    },
    "Temperance": {
      "A≈ük":"Orta yol ili≈ükiyi besler.",
      "Kariyer/Para":"Dengeli tempo s√ºrd√ºr√ºlebilir ba≈üarƒ±dƒ±r.",
      "Genel Durum":"Harmoni zamanla mayalanƒ±r."
    },
    "The Devil": {
      "A≈ük":"Baƒüƒ±mlƒ±lƒ±k/kƒ±skan√ßlƒ±k d√∂ng√ºs√ºn√º fark et, √∂zg√ºrle≈ü.",
      "Kariyer/Para":"A≈üƒ±rƒ± √ßalƒ±≈üma‚Äì√∂d√ºl tuzaƒüƒ±nƒ± sorgula.",
      "Genel Durum":"G√∂lge kalƒ±plarƒ± g√∂r√ºnce kapƒ± i√ßeriden a√ßƒ±lƒ±r."
    },
    "The Tower": {
      "A≈ük":"Yƒ±kƒ±lan kalƒ±p sahicilik alanƒ± a√ßar.",
      "Kariyer/Para":"Plan bozulduysa daha saƒülam yapƒ± doƒüar.",
      "Genel Durum":"Kriz hakikate √ßaƒürƒ±; eskiyi s√∂k."
    },
    "The Star": {
      "A≈ük":"Nazik d√ºr√ºstl√ºk ≈üifa getirir; umut tazelenir.",
      "Kariyer/Para":"Vizyonunu payla≈ü; destek bulursun.",
      "Genel Durum":"Gece uzun olsa da sabah yakƒ±n."
    },
    "The Moon": {
      "A≈ük":"Varsayƒ±m yerine duygu payla≈ü; sis daƒüƒ±lƒ±r.",
      "Kariyer/Para":"Belirsizlikte riski y√∂net; veriyi netle≈ütir.",
      "Genel Durum":"Hayal ile korkuyu ayƒ±rt et."
    },
    "The Sun": {
      "A≈ük":"ƒ∞√ßtenlik ve oyunbazlƒ±k yakƒ±nlƒ±ƒüƒ± artƒ±rƒ±r.",
      "Kariyer/Para":"G√∂r√ºn√ºr ba≈üarƒ±; emek ƒ±≈üƒ±ƒüa √ßƒ±kƒ±yor.",
      "Genel Durum":"Canlƒ±lƒ±k ve netlik y√ºksek."
    },
    "Judgement": {
      "A≈ük":"Eski defter adilce kapanƒ±rsa ikinci ≈üans m√ºmk√ºn.",
      "Kariyer/Para":"√áaƒürƒ±n netle≈üiyor; y√∂n deƒüi≈üimi yakƒ±n.",
      "Genel Durum":"Y√ºzle≈üme hafifletir; yeniden doƒüu≈ü."
    },
    "The World": {
      "A≈ük":"D√∂ng√º tamam; seviye atlama.",
      "Kariyer/Para":"Proje kapanƒ±≈üƒ±, hak edilen takdir.",
      "Genel Durum":"B√ºt√ºnl√ºk ve tamamlanma."
    }
  };

  const minorTemplates = {
    "A≈ük": {
      Wands:{Ace:"Yeni tutku kƒ±vƒ±lcƒ±mƒ±.",Two:"Birlikte ufka bakƒ±≈ü.",Three:"Uzaklardan sevindirici haber.",Four:"Kutlama ve yuva.",Five:"K√º√ß√ºk s√ºrt√º≈ümelerde ≈üefkat.",Six:"Takdir edilme.",Seven:"Sƒ±nƒ±rlarƒ±nƒ± sevgiyle koru.",Eight:"Hƒ±zlƒ± mesajlar.",Nine:"Minik bir mola.",Ten:"Y√ºkleri payla≈ü.",Page:"Fl√∂rt√∂z haberci.",Knight:"Tutkulu giri≈üim.",Queen:"Sƒ±cak √ßekim.",King:"Kararlƒ± vizyon."},
      Cups:{Ace:"Kalp kapƒ±sƒ± a√ßƒ±lƒ±yor.",Two:"Kar≈üƒ±lƒ±klƒ± √ßekim.",Three:"Payla≈üƒ±lan sevin√ß.",Four:"Durgunluk, alan a√ß.",Five:"Kƒ±rgƒ±nlƒ±k ≈üifaya √ßaƒürƒ±lƒ±yor.",Six:"Tatlƒ± anƒ±lar.",Seven:"Hayaller √ßok; se√ß.",Eight:"Olgunla≈ümak i√ßin √ßekili≈ü.",Nine:"Dilek kabul√º.",Ten:"Duygusal b√ºt√ºnl√ºk.",Page:"Tatlƒ± mesaj.",Knight:"Romantik teklif.",Queen:"Derin empati.",King:"Olgun sevgi."},
      Swords:{Ace:"Hakikati konu≈ü.",Two:"Kararsƒ±z g√∂n√ºl.",Three:"Kalp kƒ±rƒ±ƒüƒ± ≈üifasƒ±.",Four:"Dinlendiren sessizlik.",Five:"Ego sava≈üƒ±ndan uzak dur.",Six:"Sakin sulara ge√ßi≈ü.",Seven:"D√ºr√ºst√ße konu≈ü; arƒ±n.",Eight:"Kƒ±sƒ±ttan √∂zg√ºrle≈ü.",Nine:"Gece abartƒ±r; sabah konu≈ü.",Ten:"D√∂ng√º kapanƒ±r.",Page:"Nazik merak.",Knight:"Acele s√∂z kƒ±rar.",Queen:"Netlik+≈üefkat.",King:"Sƒ±nƒ±r ve d√ºr√ºstl√ºk."},
      Pentacles:{Ace:"Somut/istikrarlƒ± teklif.",Two:"Denge oyunu.",Three:"Birlikte in≈üa.",Four:"G√ºven in≈üa et.",Five:"Zor g√ºnde omuz omuza.",Six:"Vermek‚Äìalmak.",Seven:"Sabƒ±rla b√ºy√ºr.",Eight:"√ñzenli emek.",Nine:"√ñz deƒüer/zarafet.",Ten:"Uzun vadeli yuva.",Page:"Somut k√º√ß√ºk jest.",Knight:"Sadakat‚Äìs√ºreklilik.",Queen:"G√ºvenli liman.",King:"Koruyucu c√∂mertlik."}
    },
    "Kariyer/Para": {
      Wands:{Ace:"Yeni proje kƒ±vƒ±lcƒ±mƒ±.",Two:"Ufuk/plan.",Three:"Emek d√∂n√º≈ü√º.",Four:"Ba≈üarƒ± kutlamasƒ±.",Five:"Rekabet.",Six:"G√∂r√ºn√ºr ba≈üarƒ±.",Seven:"Pozisyonunu savun.",Eight:"Hƒ±zlƒ± s√ºre√ß.",Nine:"Dayan; az kaldƒ±.",Ten:"Delege et.",Page:"Pilot fikir.",Knight:"Atak ama dengeli.",Queen:"Vizyoner liderlik.",King:"Stratejik b√ºy√ºme."},
      Cups:{Ace:"ƒ∞≈üe anlam kat.",Two:"Ortaklƒ±k/uyum.",Three:"Takƒ±m ruhu.",Four:"Motivasyonu tazele.",Five:"Kayƒ±ptan √∂ƒüren.",Six:"Eski baƒülantƒ±.",Seven:"Opsiyonlarƒ± ele.",Eight:"Anlamƒ± azalan i≈üten uzakla≈ü.",Nine:"Dilek projesi olur.",Ten:"Uzun vadeli tatmin.",Page:"Nazik teklif.",Knight:"ƒ∞li≈üki y√∂netimi.",Queen:"Empatik liderlik.",King:"Duygusal zeka."},
      Swords:{Ace:"Net karar.",Two:"Veri topla.",Three:"Zor ger√ßek.",Four:"Mola/odak.",Five:"Ego sava≈üƒ±ndan ka√ßƒ±n.",Six:"Sakin faz.",Seven:"Taktik zek√¢; etik.",Eight:"Kƒ±sƒ±tƒ± yeniden √ßer√ßevele.",Nine:"Kaygƒ±ya plan yaz.",Ten:"D√∂ng√º bitti.",Page:"Analitik merak.",Knight:"Hƒ±zlƒ± uygulama.",Queen:"Objektif akƒ±l.",King:"Soƒüukkanlƒ± lider."},
      Pentacles:{Ace:"Somut fƒ±rsat.",Two:"Nakit/i≈ü dengesi.",Three:"Ustalƒ±k+ekip.",Four:"A≈üƒ±rƒ± tutma akƒ±≈üƒ± boƒüar.",Five:"Ge√ßici daralma.",Six:"Payla≈üƒ±m/fon.",Seven:"Yatƒ±rƒ±m sabƒ±r ister.",Eight:"Ustalƒ±k eƒürisi.",Nine:"Baƒüƒ±msƒ±z ba≈üarƒ±.",Ten:"G√ºvence/kurumsallƒ±k.",Page:"Staj/√∂ƒürenme.",Knight:"D√ºzenli √ßalƒ±≈üma.",Queen:"Kaynak y√∂netimi.",King:"Uzun vadeli finans aklƒ±."}
    },
    "Genel Durum": {
      Wands:{Ace:"Yeni enerji.",Two:"Y√∂n belirleme.",Three:"Emek geri d√∂ner.",Four:"Kutlama.",Five:"Ufak √ßatƒ±≈üma; esnek ol.",Six:"Zafer.",Seven:"Pozisyonunu koru.",Eight:"Hƒ±zlanma.",Nine:"Pes etme.",Ten:"Sadele≈ütir.",Page:"Merak/√∂ƒüren.",Knight:"Macera.",Queen:"Karizma.",King:"Vizyonu uygula."},
      Cups:{Ace:"Kalp tazelenir.",Two:"Uyum.",Three:"Sosyallik.",Four:"Minnet pratiƒüi.",Five:"Kalan kaynaƒüƒ± g√∂r.",Six:"Masumiyet/anƒ±.",Seven:"Se√ßenek √ßok.",Eight:"Duygusal detoks.",Nine:"Dilek enerjisi.",Ten:"B√ºt√ºnl√ºk.",Page:"Nazik haber.",Knight:"Zarafet.",Queen:"≈ûefkatli sezgi.",King:"Olgun duygu."},
      Swords:{Ace:"Zihinsel netlik.",Two:"Veri topla.",Three:"Arƒ±ndƒ±rƒ±cƒ± y√ºzle≈üme.",Four:"Dinlen/yenilen.",Five:"Gereksiz tartƒ±≈ümadan uzak.",Six:"Sakin sular.",Seven:"Zeki plan; etik.",Eight:"Kƒ±sƒ±tƒ± √ß√∂z.",Nine:"Eylem planƒ± yaz.",Ten:"D√∂ng√º kapanƒ±r.",Page:"Ara≈ütƒ±r.",Knight:"Hƒ±zlƒ± karar.",Queen:"Berrak s√∂z.",King:"Kural koy."},
      Pentacles:{Ace:"Somut ba≈ülangƒ±√ß.",Two:"Denge.",Three:"Birlikte √ºretim.",Four:"G√ºvenlik ihtiyacƒ±.",Five:"Ge√ßici sƒ±kƒ±≈üma.",Six:"Payla≈üƒ±m bereketi.",Seven:"Sabƒ±r ve √∂l√ß√ºm.",Eight:"ƒ∞≈ü√ßilik.",Nine:"Konfor/√∂zyeter.",Ten:"Kalƒ±cƒ±lƒ±k.",Page:"√ñƒürenme fƒ±rsatƒ±.",Knight:"Rutin g√º√ßt√ºr.",Queen:"≈ûefkatli d√ºzen.",King:"Uzun vadeli yapƒ±."}
    }
  };

  /* === YORUM MOTORU: ger√ßek tarot√ßu √ºslubu + boyut farkƒ± === */
  function interpretCard(name, category, posLabel, size="medium", userName=""){
    const cat = category || "Genel Durum";
    const baseText = getBaseMeaning(name, cat);
    const context = {
      name: userName || "Sevgili danƒ±≈üan",
      card: name,
      category: cat,
      position: posLabel || null
    };
    return stylize(baseText, context, size);
  }

  function getBaseMeaning(cardName, cat){
    if (majorMap[cardName]) return majorMap[cardName][cat] || majorMap[cardName]["Genel Durum"];
    const m = cardName.match(/^(Ace|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|Page|Knight|Queen|King) of (Wands|Cups|Swords|Pentacles)$/);
    if (m){
      const rank = m[1], suit = m[2];
      return (minorTemplates[cat] && minorTemplates[cat][suit] && minorTemplates[cat][suit][rank])
              ? minorTemplates[cat][suit][rank]
              : (minorTemplates["Genel Durum"][suit][rank] || "Denge ve farkƒ±ndalƒ±k √ßaƒürƒ±sƒ±.");
    }
    return "Denge ve farkƒ±ndalƒ±k √ßaƒürƒ±sƒ±.";
  }

  /* ‚Äî Boyutlandƒ±rma ve √ºslup ‚Äî */
  function stylize(base, ctx, size){
    const pos = ctx.position ? `${ctx.position} konumunda ` : "";
    const seed = `${ctx.card}|${ctx.category}`; // deterministik k√º√ß√ºk √ße≈üni
    const toneHook = hookByCategory(ctx.category, seed);

    if(size === 'short'){
      // 1‚Äì2 c√ºmle + sonu√ß
      return [
        `${ctx.name}, ${pos}${ctx.card} ≈üunu s√∂yl√ºyor: ${base}`,
        finalLine(ctx.card, ctx.category, "short")
      ].join(" ");
    }

    if(size === 'long'){
      // 9‚Äì12 c√ºmle; sembol, g√∂lge, olasƒ±lƒ±k, rit√ºel, niyet
      const sym = symbolLine(ctx.card);
      const shadow = shadowLine(ctx.card, ctx.category);
      const path = pathLine(ctx.card, ctx.category, ctx.position);
      const advice = adviceLine(ctx.card, ctx.category);
      const ritual = ritualLine(ctx.card, ctx.category);
      const intent = intentionLine(ctx.card, ctx.category);

      const parts = [
        `${ctx.name}, ${pos}${ctx.card} kartƒ±nƒ±n enerjisi a√ßƒ±lƒ±mƒ±n kalbini aydƒ±nlatƒ±yor.`,
        `${toneHook} ${base}`,
        sym, shadow, path, advice, ritual,
        `Zamanlamaya dair: ${timingLine(ctx.card)}`,
        finalLine(ctx.card, ctx.category, "long"),
        `Niyet c√ºmlen: ‚Äú${intent}‚Äù`
      ].filter(Boolean);
      return parts.join(" ");
    }

    // medium: 4‚Äì6 c√ºmle; enerji‚Äìdinamik‚Äìg√∂lge‚Äì√∂neri
    const energy = energyLine(ctx.card, ctx.category, ctx.position);
    const challenge = challengeLine(ctx.card, ctx.category);
    const tip = adviceLine(ctx.card, ctx.category);
    return [
      `${ctx.name}, ${pos}${ctx.card} ≈üunu vurguluyor: ${base}`,
      energy, challenge, tip,
      finalLine(ctx.card, ctx.category, "medium")
    ].filter(Boolean).join(" ");
  }

  /* ‚Äî Metin par√ßalarƒ± ‚Äî */
  function hookByCategory(cat, seed){
    const hooks = {
      "A≈ük":[
        "Kalbin ritmi hƒ±zlanƒ±yor; mesele yalnƒ±zca hissetmek deƒüil, hissettiƒüini s√∂ylemek.",
        "ƒ∞ki kalp arasƒ±ndaki k√∂pr√º s√∂zle ve niyetle saƒülamla≈üƒ±r."
      ],
      "Kariyer/Para":[
        "Zihin netle≈ütiƒüinde rota belirir; veri ve sezgi birlikte √ßalƒ±≈ümalƒ±.",
        "Deƒüerine denk fƒ±rsat, hazƒ±rlƒ±kla bulu≈ümak √ºzere kapƒ±da."
      ],
      "Genel Durum":[
        "Hayat senden d√ºr√ºst bir hizalanma bekliyor.",
        "K√º√ß√ºk doƒüru adƒ±mlar b√ºy√ºk kapƒ±lar a√ßar."
      ]
    }[cat] || ["ƒ∞√ß sesin bug√ºn pusulan."];
    return hooks[(hash(seed)%hooks.length)];
  }

  function energyLine(card, cat, pos){
    const lead = pos ? `${pos} enerji olarak` : "Enerji olarak";
    const map = {
      "Wands":"heves, cesaret ve hareket",
      "Cups":"duygu, empati ve yakƒ±nlƒ±k",
      "Swords":"zihin, a√ßƒ±klƒ±k ve karar",
      "Pentacles":"pratik adƒ±m, d√ºzen ve istikrar"
    };
    const suit = suitOf(card);
    const qual = suit ? map[suit] : "b√ºt√ºnc√ºl bir farkƒ±ndalƒ±k";
    return `${lead} ${qual} √∂ne √ßƒ±kƒ±yor.`;
  }

  function challengeLine(card, cat){
    if(card==="The Devil") return "G√∂lge tarafta baƒüƒ±mlƒ±lƒ±k d√∂ng√ºlerini g√∂rmezden gelmek huzuru geciktirebilir.";
    if(card==="The Tower") return "G√∂lge tarafta ani kƒ±rƒ±lmalar korkutucu g√∂r√ºnebilir; ama zemini safla≈ütƒ±rƒ±r.";
    if(card==="The Moon")  return "G√∂lge tarafta belirsizlik ve kuruntular ger√ßeƒüi perdeleyebilir.";
    const suit = suitOf(card);
    if(suit==="Swords") return "Zihnin fazla sertle≈ümesi ileti≈üimi keskinle≈ütirebilir; yumu≈üak netlik se√ßilmeli.";
    if(suit==="Wands")  return "A≈üƒ±rƒ± hƒ±z, sabrƒ± ve dinlemeyi g√∂lgeleyebilir; ritmi ayarla.";
    if(suit==="Cups")   return "Duygu yoƒüunluƒüu sƒ±nƒ±rlarƒ± eritebilir; kendine de ≈üefkat g√∂ster.";
    if(suit==="Pentacles") return "Kontrol arzusu akƒ±≈üƒ± kƒ±sƒ±tlayabilir; g√ºveni hatƒ±rla.";
    return "Dengeyi korumak temel sƒ±nav.";
  }

  function adviceLine(card, cat){
    const majorAdvice = {
      "The Magician":"Tek bir hedef se√ß ve bug√ºn 3 somut adƒ±m yaz.",
      "The High Priestess":"10 dakikalƒ±k sessizlikte sezgini dinle.",
      "The Emperor":"Haftalƒ±k basit bir plan olu≈ütur.",
      "The Lovers":"Bir net ‚Äòevet‚Äô ve bir net ‚Äòhayƒ±r‚Äô belirle.",
      "The Chariot":"G√ºn√ºn ilk saatini en √∂nemli i≈üe ayƒ±r.",
      "Strength":"Yanƒ±t vermeden √∂nce derin bir nefes al.",
      "Death":"Artƒ±k hizmet etmeyeni bƒ±rak.",
      "Temperance":"Programƒ±na mikro molalar yerle≈ütir.",
      "The Devil":"Bir mini ‚Äòdetoks‚Äô sƒ±nƒ±rƒ± koy.",
      "The Tower":"Bir fazlalƒ±ƒüƒ± s√∂k ve sadele≈ütir.",
      "The Star":"Nazik bir hedef koy; minik bir adƒ±m at.",
      "The Moon":"Konuyu yazƒ±ya d√∂k; sis daƒüƒ±lƒ±r.",
      "The Sun":"K√º√ß√ºk bir ba≈üarƒ±yƒ± kutla.",
      "Judgement":"Bug√ºnden bir ders √ßƒ±kar ve uygula.",
      "The World":"Tamamladƒ±ƒüƒ±nƒ± g√∂r√ºn√ºr kƒ±l, ≈ü√ºkret."
    }[card];
    if(majorAdvice) return `√ñneri: ${majorAdvice}`;
    const suit = suitOf(card);
    const suitAdvice = {
      "Wands":"Enerjini tek bir uƒüraƒüa odakla.",
      "Cups":"Kalpten ve a√ßƒ±k konu≈ü.",
      "Swords":"Net hedef‚Äìnet ileti≈üim kur.",
      "Pentacles":"K√º√ß√ºk ama d√ºzenli adƒ±m at."
    }[suit] || "Bug√ºn k√º√ß√ºk ama anlamlƒ± bir adƒ±m at.";
    return `√ñneri: ${suitAdvice}`;
  }

  function ritualLine(card, cat){
    if(cat==="A≈ük") return "Rit√ºel: 5 dakika boyunca kalbinin ritmine odaklan; sonra duygunu bir c√ºmleyle ifade et.";
    if(cat==="Kariyer/Para") return "Rit√ºel: 10 dakika tek g√∂rev odak; bitince k√º√ß√ºk bir kutu i≈üareti koy.";
    return "Rit√ºel: 3 derin nefes + g√ºn√ºn niyetini bir c√ºmle yaz.";
  }

  function intentionLine(card, cat){
    if(cat==="A≈ük") return "Kalbimi a√ßƒ±k ve nazik√ße ifade ediyorum.";
    if(cat==="Kariyer/Para") return "Deƒüerimle uyumlu fƒ±rsatlara cesaretle adƒ±m atƒ±yorum.";
    return "Dengeyi se√ßiyor, k√º√ß√ºk adƒ±mlarla ilerliyorum.";
  }

  function symbolLine(card){
    if(card==="The Sun") return "Sembol dili: G√ºne≈ü kartƒ± a√ßƒ±klƒ±k, ne≈üe ve saf canlƒ±lƒ±k getirir; √ßocuk bilincin d√ºr√ºst√ße parlƒ±yor.";
    if(card==="The Moon") return "Sembol dili: Ay kartƒ± sezgi, r√ºya ve belirsizlikle y√ºzle≈ümeyi √ßaƒüƒ±rƒ±r.";
    if(card==="The Star") return "Sembol dili: Yƒ±ldƒ±z kartƒ± ≈üifa, umut ve i√ßsel rehberliktir.";
    if(card==="The Tower") return "Sembol dili: Kule, yƒ±kƒ±mƒ±n i√ßindeki arƒ±nmadƒ±r; sahte olan √ß√∂ker.";
    return "Sembol dili: Kartƒ±n arketipi seni √∂z√ºne yakla≈ütƒ±ran bir ayna g√∂revi g√∂r√ºyor.";
  }

  function shadowLine(card, cat){
    if(card==="The Devil") return "G√∂lge: Baƒüƒ±mlƒ±lƒ±k, kƒ±skan√ßlƒ±k ya da kontrol arzusunun zincirlerini fark edip √ß√∂zmek.";
    if(card==="The Hanged Man") return "G√∂lge: Pasif bekleyi≈üe saplanmak yerine, anlamƒ± deƒüi≈ütirerek √∂zg√ºrle≈ümek.";
    const suit = suitOf(card);
    if(suit==="Swords") return "G√∂lge: A≈üƒ±rƒ± analiz, kalp temasƒ±nƒ± kesebilir.";
    if(suit==="Cups") return "G√∂lge: Duygusal ta≈ükƒ±nlƒ±k sƒ±nƒ±rlarƒ± eritebilir.";
    if(suit==="Wands") return "G√∂lge: Sabƒ±rsƒ±zlƒ±k acele karara iter.";
    if(suit==="Pentacles") return "G√∂lge: A≈üƒ±rƒ± kontrol akƒ±≈üƒ± tƒ±kar.";
    return "G√∂lge: Dengeyi unutturacak abartƒ±lardan sakƒ±n.";
  }

  function pathLine(card, cat, pos){
    const anchor = pos ? `${pos} kartƒ±` : "Bu kart";
    if(cat==="A≈ük") return `${anchor}, ili≈ükide sahicilikle adƒ±m atƒ±ldƒ±ƒüƒ±nda yakƒ±nlƒ±ƒüƒ±n doƒüal bi√ßimde derinle≈üeceƒüini anlatƒ±yor.`;
    if(cat==="Kariyer/Para") return `${anchor}, deƒüerinle uyumlu hedefe odaklandƒ±ƒüƒ±nda somut sonu√ßlarƒ±n hƒ±zlanacaƒüƒ±nƒ± s√∂yl√ºyor.`;
    return `${anchor}, g√ºnl√ºk hayatta k√º√ß√ºk ama istikrarlƒ± se√ßimlerin kader √ßizgisini ince ince deƒüi≈ütirdiƒüini fƒ±sƒ±ldƒ±yor.`;
  }

  function timingLine(card){
    if(card==="The Wheel of Fortune") return "D√∂ng√º tamamlandƒ±ƒüƒ±nda fƒ±rsat g√∂r√ºn√ºr.";
    if(card==="The Chariot") return "Hƒ±zlƒ± s√ºre√ß; karar sonrasƒ± ivme artar.";
    if(card==="Temperance") return "Aƒüƒ±r ama kalƒ±cƒ±; sabƒ±r √∂d√ºllendirilir.";
    if(card==="The Moon") return "Netlik geceden sabaha gelir; acele etme.";
    return "Zamanlama, net niyet ve k√º√ß√ºk adƒ±mla hƒ±zlanƒ±r.";
  }

  function finalLine(card, cat, size){
    if(size==="short") return "√ñzet: Net ol, k√º√ß√ºk bir adƒ±m at ve kalbinle hizalan.";
    if(size==="long")  return "Son s√∂z: Hakikate sadƒ±k kaldƒ±ƒüƒ±nda yol kendi kendini a√ßar; evren netliƒüi sever.";
    return "√ñzet: Denge, d√ºr√ºst ifade ve k√º√ß√ºk bir somut adƒ±m bug√ºn en doƒüru kombinasyon.";
  }

  /* === Yardƒ±mcƒ±lar === */
  function sizeLabel(v){ return v==='short'?'Kƒ±sa': v==='long'?'Uzun':'Orta'; }
  function buildDecks(mode){
    const shuffled = shuffle(ALL_CARDS.map(c=>c.id));
    let decksCount = 6, size = 13;
    if(mode==='cross'){ decksCount=3; size=26; }
    const decks = []; let i=0;
    for(let d=0; d<decksCount; d++){ decks.push(shuffled.slice(i, i+size)); i+=size; }
    return { count: decksCount, size, decks };
  }
  function requiredCount(m){ if(m==='one')return 1; if(m==='three')return 3; if(m==='five')return 5; if(m==='cross')return 10; if(m==='relationship')return 7; return 1; }
  function shuffle(arr){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
  function escapeHtml(s=''){ return s.replace(/[&<>"']/g, ch=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[ch])); }
  function resetAll(){ state.name=''; state.mode=null; state.category=null; state.yesnoQuestion=''; state.decksMeta=null; state.chosenDeckIndex=null; state.selectedCards=[]; state.needSelect=0; state.commentSize='medium'; }
  function hash(str){ let h=0; for(let i=0;i<str.length;i++){ h=((h<<5)-h)+str.charCodeAt(i); h|=0; } return Math.abs(h); }

})();
</script>
