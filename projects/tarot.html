<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>DENIZIM â€¢ Tarot FalÄ±</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- DIÅž CSS (varsa kullanÄ±lÄ±r) -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- KRÄ°TÄ°K STÄ°LLER (fallback) -->
  <style>
    html,body{background:#f9d5d3;margin:0;padding:0;height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#111}
    /* navbar */
    .navbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:rgba(255,255,255,.45);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.6);box-shadow:0 12px 30px rgba(0,0,0,.08)}
    .nav-left,.nav-center,.nav-right{display:flex;align-items:center;gap:12px}
    .nav-center{gap:6px}
    .brand{font-weight:900;letter-spacing:1px;text-decoration:none;color:#111;font-size:20px;padding:8px 10px;border-radius:12px}
    .nav-link{position:relative;background:none;border:none;cursor:pointer;color:#2a2a2a;font-weight:700;padding:10px 12px;border-radius:12px;text-decoration:none}
    .nav-link.active{color:#111}
    .nav-link.active::after{content:"";position:absolute;left:12px;right:12px;bottom:6px;height:2px;background:linear-gradient(90deg,#d9bf75,#b7902c);border-radius:2px;opacity:.9}
    .dropdown{position:relative}
    .dropdown-menu{position:absolute;top:calc(100% + 10px);left:0;min-width:220px;padding:10px;display:none;background:rgba(255,255,255,.85);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.7);border-radius:14px;box-shadow:0 18px 40px rgba(0,0,0,.15);transform:scale(.98) translateY(-4px);opacity:0;transition:opacity .18s,transform .18s}
    .dropdown.open .dropdown-menu{display:block;opacity:1;transform:scale(1) translateY(0)}
    .dropdown-item{display:block;padding:10px 12px;border-radius:10px;text-decoration:none;color:#222;font-weight:600}
    .dropdown-item:hover{background:linear-gradient(90deg,rgba(217,191,117,.25),rgba(183,144,44,.25))}
    /* container */
    .container{max-width:1000px;margin:24px auto;padding:20px;background:rgba(255,255,255,.9);border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.12)}
    /* tarot kartlarÄ± */
    .section{margin-top:14px}
    .muted{color:#555;font-size:14px}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 16px;border:none;border-radius:12px;background:#111;color:#fff;font-weight:700;cursor:pointer}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:12px;margin-top:12px}
    .card{position:relative;aspect-ratio:2/3;border-radius:12px;overflow:hidden;cursor:pointer;border:1px solid #e9e9e9;background:#eee;box-shadow:0 6px 16px rgba(0,0,0,.1);perspective:1200px}
    .card-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .6s cubic-bezier(.2,.8,.2,1)}
    .card:hover .card-inner{transform:rotateY(8deg)}
    .card.flipped .card-inner{transform:rotateY(180deg)}
    .face,.back{position:absolute;inset:0;border-radius:12px;backface-visibility:hidden;background:#fff;display:flex}
    .face{transform:rotateY(180deg)}
    .face img,.back img{width:100%;height:100%;object-fit:contain;object-position:center;display:block}
    .sel-badge{position:absolute;bottom:6px;left:6px;background:#111;color:#fff;font-size:11px;font-weight:700;padding:4px 8px;border-radius:8px;z-index:3}
    .final-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:14px;margin-top:12px}
    .final-card{border:1px solid #eee;border-radius:14px;overflow:hidden;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .final-card .img{aspect-ratio:2/3;background:#fafafa}
    .final-card .img img{width:100%;height:100%;object-fit:contain;display:block;background:#fff}
    .final-card .cap{padding:8px 10px;font-size:13px;color:#444;text-align:center}
    .reading{margin-top:16px;padding:16px;background:#fff;border:1px solid #eee;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .reading .item{background:#fdf1f1;border:1px solid #fde1e1;border-radius:12px;padding:12px;margin-top:10px}
  </style>
</head>
<body>

  <!-- ÅžÄ°FRE -->
  <script src="../assets/js/gate.js"></script>

  <!-- NAV -->
  <header class="navbar">
    <div class="nav-left">
      <a class="brand" href="../index.html">DENIZIM</a>
    </div>
    <nav class="nav-center">
      <a class="nav-link" href="../index.html">Home</a>
      <div class="dropdown" id="dd-projects">
        <button class="nav-link" aria-haspopup="true" aria-expanded="false">Projects â–¾</button>
        <div class="dropdown-menu" role="menu">
          <a class="dropdown-item" href="../projects/tarot.html" role="menuitem">Tarot FalÄ±</a>
        </div>
      </div>
    </nav>
    <div class="nav-right"></div>
  </header>

  <div class="container">
    <div id="tarot-app"></div>
  </div>

  <!-- DROPDOWN JS (saÄŸlam) -->
  <script>
  (function(){
    let openDD=null, closeTimer=null;
    function open(dd){ if(openDD && openDD!==dd) openDD.classList.remove('open'); dd.classList.add('open'); dd.querySelector('button')?.setAttribute('aria-expanded','true'); openDD=dd; }
    function close(dd){ const n=dd||openDD; if(!n) return; n.classList.remove('open'); n.querySelector('button')?.setAttribute('aria-expanded','false'); if(openDD===n) openDD=null; }
    function scheduleClose(dd,ms=180){ clearTimeout(closeTimer); closeTimer=setTimeout(()=>close(dd),ms); }
    document.addEventListener('click',(e)=>{ const btn=e.target.closest('.dropdown>button'); if(btn){ e.preventDefault(); const dd=btn.parentElement; dd.classList.contains('open')?close(dd):open(dd); return; }}, true);
    document.addEventListener('click',(e)=>{ if(!e.target.closest('.dropdown')) close(null); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') close(null); });
    document.querySelectorAll('.dropdown').forEach(dd=>{
      dd.addEventListener('mouseenter',()=>clearTimeout(closeTimer));
      dd.addEventListener('mouseleave',()=>scheduleClose(dd));
      const menu=dd.querySelector('.dropdown-menu');
      if(menu){
        menu.addEventListener('mouseenter',()=>clearTimeout(closeTimer));
        menu.addEventListener('mouseleave',()=>scheduleClose(dd));
      }
    });
  })();
  </script>

  <!-- TAROT APP -->
  <script>
  (function(){
    const CARD_BACK_IMAGE_URL = "https://steve-p.org/cards/pix/RWSa-X-BA.png";
    const CARD_IMAGES = {
      "The Fool":"https://steve-p.org/cards/pix/RWSa-T-00.png","The Magician":"https://steve-p.org/cards/pix/RWSa-T-01.png","The High Priestess":"https://steve-p.org/cards/pix/RWSa-T-02.png","The Empress":"https://steve-p.org/cards/pix/RWSa-T-03.png","The Emperor":"https://steve-p.org/cards/pix/RWSa-T-04.png","The Hierophant":"https://steve-p.org/cards/pix/RWSa-T-05.png","The Lovers":"https://steve-p.org/cards/pix/RWSa-T-06.png","The Chariot":"https://steve-p.org/cards/pix/RWSa-T-07.png","Strength":"https://steve-p.org/cards/pix/RWSa-T-08.png","The Hermit":"https://steve-p.org/cards/pix/RWSa-T-09.png","Wheel of Fortune":"https://steve-p.org/cards/pix/RWSa-T-10.png","Justice":"https://steve-p.org/cards/pix/RWSa-T-11.png","The Hanged Man":"https://steve-p.org/cards/pix/RWSa-T-12.png","Death":"https://steve-p.org/cards/pix/RWSa-T-13.png","Temperance":"https://steve-p.org/cards/pix/RWSa-T-14.png","The Devil":"https://steve-p.org/cards/pix/RWSa-T-15.png","The Tower":"https://steve-p.org/cards/pix/RWSa-T-16.png","The Star":"https://steve-p.org/cards/pix/RWSa-T-17.png","The Moon":"https://steve-p.org/cards/pix/RWSa-T-18.png","The Sun":"https://steve-p.org/cards/pix/RWSa-T-19.png","Judgement":"https://steve-p.org/cards/pix/RWSa-T-20.png","The World":"https://steve-p.org/cards/pix/RWSa-T-21.png",
      "Ace of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-0A.webp","Two of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-02.webp","Three of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-03.webp","Four of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-04.webp","Five of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-05.webp","Six of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-06.webp","Seven of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-07.webp","Eight of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-08.webp","Nine of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-09.webp","Ten of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-10.webp","Page of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-J1.webp","Knight of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-J2.webp","Queen of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-QU.webp","King of Wands":"https://steve-p.org/cards/small/sm_RWSa-W-KI.webp",
      "Ace of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-0A.webp","Two of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-02.webp","Three of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-03.webp","Four of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-04.webp","Five of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-05.webp","Six of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-06.webp","Seven of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-07.webp","Eight of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-08.webp","Nine of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-09.webp","Ten of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-10.webp","Page of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-J1.webp","Knight of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-J2.webp","Queen of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-QU.webp","King of Cups":"https://steve-p.org/cards/small/sm_RWSa-C-KI.webp",
      "Ace of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-0A.webp","Two of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-02.webp","Three of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-03.webp","Four of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-04.webp","Five of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-05.webp","Six of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-06.webp","Seven of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-07.webp","Eight of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-08.webp","Nine of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-09.webp","Ten of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-10.webp","Page of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-J1.webp","Knight of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-J2.webp","Queen of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-QU.webp","King of Swords":"https://steve-p.org/cards/small/sm_RWSa-S-KI.webp",
      "Ace of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-0A.png","Two of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-02.png","Three of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-03.png","Four of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-04.png","Five of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-05.png","Six of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-06.png","Seven of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-07.png","Eight of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-08.png","Nine of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-09.png","Ten of Pentacles":"https://steve-p.org/cards/pix/RWSa-P-10.png","Page of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-J1.webp","Knight of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-J2.webp","Queen of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-QU.webp","King of Pentacles":"https://steve-p.org/cards/small/sm_RWSa-P-KI.webp"
    };

    const DEFAULT_BACK = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 450'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='#f9d5d3'/><stop offset='100%' stop-color='#fbe8e6'/></linearGradient><pattern id='p' width='20' height='20' patternUnits='userSpaceOnUse'><circle cx='10' cy='10' r='2' fill='#f3b6b3' opacity='0.6'/></pattern></defs><rect width='100%' height='100%' fill='url(#g)'/><rect width='100%' height='100%' fill='url(#p)'/></svg>`;
    const backUrl = () => (CARD_BACK_IMAGE_URL && CARD_BACK_IMAGE_URL.trim()) ? CARD_BACK_IMAGE_URL : DEFAULT_BACK;
    const faceUrlFor = (name) => (CARD_IMAGES[name] && CARD_IMAGES[name].trim()) ? CARD_IMAGES[name] : backUrl();

    const MAJOR=['The Fool','The Magician','The High Priestess','The Empress','The Emperor','The Hierophant','The Lovers','The Chariot','Strength','The Hermit','Wheel of Fortune','Justice','The Hanged Man','Death','Temperance','The Devil','The Tower','The Star','The Moon','The Sun','Judgement','The World'];
    const SUITS=['Wands','Cups','Swords','Pentacles'];
    const RANKS=['Ace','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Page','Knight','Queen','King'];
    const MINOR=SUITS.flatMap(s=>RANKS.map(r=>`${r} of ${s}`));
    const ALL_CARDS=[...MAJOR,...MINOR].map((name,idx)=>({id:idx,name}));

    const YESNO={ "The Sun":"yes","The Lovers":"yes","The World":"yes","The Tower":"no","Death":"no","The Devil":"no" };
    const suitOf=n=>SUITS.find(s=>n.includes(` of ${s}`));
    const defaultYesNo=n=>suitOf(n)==="Swords"?"no":suitOf(n)==="Cups"?"maybe":"yes";

    const positions={
      three:['GeÃ§miÅŸ','Åžimdi','Gelecek'],
      five:['GeÃ§miÅŸ','Åžimdi','Gizli Etkiler','Engeller/Zorluklar','Gelecek'],
      cross:['Åžimdiki Durum','Engeller/Zorluklar','BilinÃ§li FarkÄ±ndalÄ±k','BilinÃ§altÄ±/Temel','GeÃ§miÅŸ','Gelecek','Sen','KarÅŸÄ± Taraf','Umutlar/Korkular','SonuÃ§'],
      relationship:['Senin DuygularÄ±n','Onun DuygularÄ±','Senin DÃ¼ÅŸÃ¼ncelerin','Onun DÃ¼ÅŸÃ¼nceleri','AranÄ±zdaki BaÄŸ','Engeller/Sorunlar','Gelecek OlasÄ± SonuÃ§']
    };

    const state={name:"",mode:null,category:null,yesnoQuestion:"",decksMeta:null,chosenDeckIndex:null,needSelect:0,selectedCards:[],commentSize:"medium"};
    const root=document.getElementById('tarot-app'); render();

    function render(){
      if(state.selectedCards.length===state.needSelect && state.needSelect>0) return renderFinal();
      root.innerHTML=`
        <h1>ðŸ”® Online Tarot</h1>
        <div class="muted">Ä°smini, aÃ§Ä±lÄ±mÄ± ve <b>yorum boyutunu</b> seÃ§. Tek Kartâ€™ta evet/hayÄ±r sorununu yaz.</div>
      `;
      const step1=document.createElement('div'); step1.className='section';
      step1.innerHTML=`
        <div style="display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));">
          <div><label class="muted">Ä°smin</label><input id="inp-name" type="text" placeholder="Ä°smini yaz" value="${esc(state.name)}"></div>
          <div><label class="muted">AÃ§Ä±lÄ±m TÃ¼rÃ¼</label>
            <select id="sel-mode">
              <option value="">SeÃ§inizâ€¦</option>
              <option value="one" ${state.mode==='one'?'selected':''}>Tek Kart</option>
              <option value="three" ${state.mode==='three'?'selected':''}>3 Kart</option>
              <option value="five" ${state.mode==='five'?'selected':''}>5 Kart</option>
              <option value="cross" ${state.mode==='cross'?'selected':''}>HaÃ§ AÃ§Ä±lÄ±mÄ±</option>
              <option value="relationship" ${state.mode==='relationship'?'selected':''}>Ä°liÅŸki AÃ§Ä±lÄ±mÄ±</option>
            </select>
          </div>
          <div><label class="muted">Yorum Boyutu</label>
            <select id="sel-size">
              <option value="short" ${state.commentSize==='short'?'selected':''}>KÄ±sa</option>
              <option value="medium" ${state.commentSize==='medium'?'selected':''}>Orta</option>
              <option value="long" ${state.commentSize==='long'?'selected':''}>Uzun</option>
            </select>
          </div>
        </div>`;
      root.appendChild(step1);

      if(state.mode==='one'){
        const step2=document.createElement('div'); step2.className='section';
        step2.innerHTML=`<label class="muted">Evet / HayÄ±r Sorun</label><textarea id="inp-yn" placeholder="Ã–rn: BugÃ¼nkÃ¼ gÃ¶rÃ¼ÅŸmem olumlu geÃ§er mi?">${esc(state.yesnoQuestion)}</textarea>`;
        root.appendChild(step2);
      }else if(state.mode){
        const step2=document.createElement('div'); step2.className='section';
        step2.innerHTML=`<label class="muted">Kategori</label>
          <select id="sel-cat">
            <option value="">SeÃ§inizâ€¦</option>
            <option value="AÅŸk" ${state.category==='AÅŸk'?'selected':''}>AÅŸk</option>
            <option value="Kariyer/Para" ${state.category==='Kariyer/Para'?'selected':''}>Kariyer/Para</option>
            <option value="Genel Durum" ${state.category==='Genel Durum'?'selected':''}>Genel Durum</option>
          </select>`;
        root.appendChild(step2);
      }

      const canBuild = state.name && state.mode && (state.mode==='one' || !!state.category);
      const step3=document.createElement('div'); step3.className='section';
      step3.innerHTML=`<button id="btn-decks" class="btn" ${!canBuild?'disabled':''}>Desteleri OluÅŸtur</button>${state.decksMeta?'<span class="muted" style="margin-left:8px;">HazÄ±r</span>':''}`;
      root.appendChild(step3);

      if(state.decksMeta){
        if(state.chosenDeckIndex===null){
          const wr=document.createElement('div'); wr.className='section'; wr.innerHTML=`<div class="decks" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px"></div>`;
          const el=wr.querySelector('.decks');
          state.decksMeta.decks.forEach((deck,i)=>{
            const d=document.createElement('div'); d.className='deck'; d.textContent=`ðŸƒ Deste ${i+1}`; d.style.cssText="background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,.08);cursor:pointer";
            d.addEventListener('click',()=>{state.chosenDeckIndex=i;state.needSelect=reqCount(state.mode);state.selectedCards=[];render();});
            el.appendChild(d);
          });
          root.appendChild(wr);
        }else{
          const deck=state.decksMeta.decks[state.chosenDeckIndex];
          const wr=document.createElement('div'); wr.className='section';
          wr.innerHTML=`
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
              <span class="muted">Deste ${state.chosenDeckIndex+1}</span>
              <span class="muted">SeÃ§ilecek: <b>${state.needSelect}</b></span>
              <div style="flex:1"></div>
              <button id="btn-change-deck" class="btn" style="background:#555">Desteyi DeÄŸiÅŸtir</button>
            </div>
            <div class="cards" id="cards-grid"></div>`;
          root.appendChild(wr);

          const grid=wr.querySelector('#cards-grid');
          deck.forEach(cardId=>{
            const cd=ALL_CARDS[cardId];
            const c=document.createElement('div'); c.className='card';
            const inner=document.createElement('div'); inner.className='card-inner';
            const back=document.createElement('div'); back.className='back'; const bi=document.createElement('img'); bi.src=backUrl(); back.appendChild(bi);
            const face=document.createElement('div'); face.className='face'; const fi=document.createElement('img'); fi.src=faceUrlFor(cd.name); fi.alt=cd.name; fi.loading='lazy'; fi.decoding='async'; fi.referrerPolicy='no-referrer'; fi.onerror=()=>{fi.src=backUrl();}; face.appendChild(fi);
            inner.appendChild(back); inner.appendChild(face); c.appendChild(inner);
            c.addEventListener('click',()=>{
              if(c.classList.contains('flipped')) return;
              if(state.selectedCards.length>=state.needSelect) return;
              c.classList.add('flipped');
              c.insertAdjacentHTML('beforeend',`<div class="sel-badge">#${state.selectedCards.length+1}</div>`);
              state.selectedCards.push({id:cardId,name:cd.name});
              if(state.selectedCards.length===state.needSelect){ setTimeout(render,350); }
            });
            grid.appendChild(c);
          });

          wr.querySelector('#btn-change-deck').addEventListener('click',()=>{state.chosenDeckIndex=null;state.selectedCards=[];render();});
        }
      }

      // wire
      const nameEl=document.getElementById('inp-name');
      const modeEl=document.getElementById('sel-mode');
      const catEl=document.getElementById('sel-cat');
      const ynEl=document.getElementById('inp-yn');
      const sizeEl=document.getElementById('sel-size');
      const decksBtn=document.getElementById('btn-decks');

      nameEl && nameEl.addEventListener('input',e=>state.name=e.target.value.trim());
      modeEl && modeEl.addEventListener('change',e=>{state.mode=e.target.value||null;state.category=null;state.yesnoQuestion='';state.decksMeta=null;state.chosenDeckIndex=null;state.selectedCards=[];state.needSelect=0;render();});
      sizeEl && sizeEl.addEventListener('change',e=>state.commentSize=e.target.value||'medium');
      catEl && catEl.addEventListener('change',e=>{state.category=e.target.value||null;render();});
      ynEl && ynEl.addEventListener('input',e=>state.yesnoQuestion=e.target.value);
      decksBtn && decksBtn.addEventListener('click',()=>{ if(!(state.name&&state.mode&&(state.mode==='one'||!!state.category)))return; state.decksMeta=buildDecks(state.mode); state.chosenDeckIndex=null; state.selectedCards=[]; state.needSelect=reqCount(state.mode); render(); });
    }

    function renderFinal(){
      const pos=positions[state.mode]||[];
      const title=state.mode==='one'?'Tek Kart':state.mode==='three'?'3 Kart':state.mode==='five'?'5 Kart':state.mode==='cross'?'HaÃ§ AÃ§Ä±lÄ±mÄ±':'Ä°liÅŸki AÃ§Ä±lÄ±mÄ±';
      const header=`<h1>ðŸ”® Online Tarot â€¢ ${title}</h1><div class="muted">${esc(state.name)}${state.category?' â€¢ Kategori: '+esc(state.category):''} â€¢ Yorum: ${state.commentSize==='short'?'KÄ±sa':state.commentSize==='long'?'Uzun':'Orta'}</div>`;
      const gridCards=state.selectedCards.map((c,i)=>`<div class="final-card"><div class="img"><img src="${faceUrlFor(c.name)}" alt="${esc(c.name)}" onerror="this.src='${backUrl()}'" referrerpolicy="no-referrer"></div><div class="cap"><b>${pos[i]?pos[i]+': ':''}${esc(c.name)}</b></div></div>`).join('');
      let readingHtml='';
      if(state.mode==='one'){
        const c=state.selectedCards[0]; const yn=(YESNO[c.name]||defaultYesNo(c.name)).toUpperCase();
        readingHtml+=`<div class="item"><div class="meta">Soru: <b>${esc(state.yesnoQuestion||'â€”')}</b> â€¢ YanÄ±t eÄŸilimi: <b>${yn}</b></div>${interpret(c.name,state.category||'Genel Durum','Tek Kart',state.commentSize,state.name)}</div>`;
      }else{
        const posNames=positions[state.mode]||[];
        state.selectedCards.forEach((c,i)=>{ readingHtml+=`<div class="item"><div class="meta">${posNames[i]||('Kart '+(i+1))}</div><b>${esc(c.name)}</b><div style="margin-top:6px;">${interpret(c.name,state.category||'Genel Durum',posNames[i]||null,state.commentSize,state.name)}</div></div>`; });
      }
      root.innerHTML=`${header}<div class="final-grid">${gridCards}</div><div class="reading"><h3>ðŸ§¿ Yorum</h3>${readingHtml}<div style="margin-top:12px;"><button class="btn" id="btn-again">Yeniden Dene</button></div></div>`;
      document.getElementById('btn-again').addEventListener('click',()=>{resetAll();render();});
    }

    /* â€” Yorum motoru (kÄ±saltÄ±lmÄ±ÅŸ; Ã¶nceki sÃ¼rÃ¼mÃ¼n aynÄ±sÄ±) â€” */
    const majorMap={"The Fool":{"AÅŸk":"Kalbin yeni bir maceraya hazÄ±r; korkusuz ama saygÄ±lÄ± adÄ±mlar taze romantizmi Ã§aÄŸÄ±rÄ±r.","Kariyer/Para":"GiriÅŸim kÄ±vÄ±lcÄ±mÄ±; hesaplÄ± risk ve Ã¶ÄŸrenme hevesi gÃ¶rÃ¼nÃ¼rlÃ¼k getirir.","Genel Durum":"â€˜Deneyimleâ€™ diyor; iÃ§ merakla ilerle, yol yÃ¼rÃ¼rken aÃ§Ä±lÄ±r."},"The Magician":{"AÅŸk":"Ä°fade gÃ¼cÃ¼n yÃ¼ksek; net talep ve aÃ§Ä±k kalp iliÅŸkide sihir yaratÄ±r.","Kariyer/Para":"Kaynak ve beceri sende; tek hedefe odaklan, kapÄ± aralanÄ±r.","Genel Durum":"Niyetâ€“sÃ¶zâ€“eylem hizasÄ± kapÄ±larÄ± aÃ§ar."},"The High Priestess":{"AÅŸk":"Sezgini dinle; acele etmeyerek kazanÄ±rsÄ±n.","Kariyer/Para":"Veri+sezgi doÄŸru zamanÄ± gÃ¶steriyor.","Genel Durum":"RÃ¼yalar/iÅŸaretler gÃ¼Ã§lÃ¼; iÃ§ ses pusulan."},"The Empress":{"AÅŸk":"Åžefkat ve sÄ±caklÄ±k baÄŸÄ± bÃ¼yÃ¼tÃ¼r.","Kariyer/Para":"Besleyen ritim bereket getirir.","Genel Durum":"DoÄŸayla temas ve yaratÄ±m artar."},"The Emperor":{"AÅŸk":"SaÄŸlÄ±klÄ± sÄ±nÄ±rlar gÃ¼ven verir.","Kariyer/Para":"Planâ€“takvimâ€“sorumluluk otoriteyi pekiÅŸtirir.","Genel Durum":"Kontrol edebildiÄŸine odaklan."},"The Hierophant":{"AÅŸk":"RitÃ¼eller baÄŸa derinlik katar.","Kariyer/Para":"Ustaâ€“Ã§Ä±rak modeli ilerletir.","Genel Durum":"Gelenek ve bilgelik omurgandÄ±r."},"The Lovers":{"AÅŸk":"Kalp uyumu ve seÃ§im; aÃ§Ä±k konuÅŸma ÅŸart.","Kariyer/Para":"DeÄŸer uyumlu karar uzun vadede tatmin.","Genel Durum":"Evetlerin/hayÄ±rlarÄ±n pusulandÄ±r."},"The Chariot":{"AÅŸk":"AynÄ± yÃ¶ne bakmak ivme verir.","Kariyer/Para":"Tek hedefe kilitlen; disiplin sonuÃ§ getirir.","Genel Durum":"Ä°rade rotadÄ±r."},"Strength":{"AÅŸk":"YumuÅŸak cesaret yakÄ±nlÄ±ÄŸÄ± derinleÅŸtirir.","Kariyer/Para":"SÃ¼reklilik kazanÄ±r.","Genel Durum":"Nazik gÃ¼Ã§ gerilimi eritir."},"The Hermit":{"AÅŸk":"KÄ±sa geri Ã§ekiliÅŸ berraklÄ±k saÄŸlar.","Kariyer/Para":"Stratejik yalnÄ±zlÄ±k odak kazandÄ±rÄ±r.","Genel Durum":"Ä°Ã§ fenerini izle."},"Wheel of Fortune":{"AÅŸk":"Zamanlama oyunu; akÄ±ÅŸa uy.","Kariyer/Para":"Esneklik fÄ±rsatÄ± bÃ¼yÃ¼tÃ¼r.","Genel Durum":"DÃ¶ngÃ¼sel akÄ±ÅŸta ÅŸans gÃ¶rÃ¼nÃ¼r."},"Justice":{"AÅŸk":"EÅŸit emek gÃ¼veni tazeler.","Kariyer/Para":"Åžeffaf sÃ¶zleÅŸme riski azaltÄ±r.","Genel Durum":"Adil karar huzur getirir."},"The Hanged Man":{"AÅŸk":"Onun penceresinden bakmak sihirlidir.","Kariyer/Para":"Beklemek stratejik olabilir.","Genel Durum":"Teslimiyet yaratÄ±cÄ± boÅŸluk aÃ§ar."},"Death":{"AÅŸk":"Eski kalÄ±bÄ± bÄ±rak; baÄŸ tazelensin.","Kariyer/Para":"Hizmet etmeyeni kapat.","Genel Durum":"DÃ¶nÃ¼ÅŸÃ¼m kaÃ§Ä±nÄ±lmaz."},"Temperance":{"AÅŸk":"Orta yol besler.","Kariyer/Para":"Dengeli tempo kalÄ±cÄ±dÄ±r.","Genel Durum":"Harmoni mayalanÄ±r."},"The Devil":{"AÅŸk":"BaÄŸÄ±mlÄ±lÄ±k/kÄ±skanÃ§lÄ±k dÃ¶ngÃ¼sÃ¼nÃ¼ bÄ±rak.","Kariyer/Para":"Ã–dÃ¼l tuzaÄŸÄ±nÄ± sorgula.","Genel Durum":"GÃ¶lgeyi gÃ¶rÃ¼nce Ã¶zgÃ¼rleÅŸirsin."},"The Tower":{"AÅŸk":"YÄ±kÄ±lan kalÄ±p sahicilik aÃ§ar.","Kariyer/Para":"Plan bozulsa da daha saÄŸlamÄ± doÄŸar.","Genel Durum":"Kriz hakikate Ã§aÄŸrÄ±dÄ±r."},"The Star":{"AÅŸk":"Nazik dÃ¼rÃ¼stlÃ¼k ÅŸifa getirir.","Kariyer/Para":"Vizyonunu paylaÅŸ; destek al.","Genel Durum":"Umut tazelenir."},"The Moon":{"AÅŸk":"VarsayÄ±m yerine duygu paylaÅŸ.","Kariyer/Para":"Belirsizlikte veriyi netleÅŸtir.","Genel Durum":"Hayal/korkuyu ayÄ±rt et."},"The Sun":{"AÅŸk":"Ä°Ã§tenlik yakÄ±nlÄ±ÄŸÄ± artÄ±rÄ±r.","Kariyer/Para":"Emek gÃ¶rÃ¼nÃ¼r baÅŸarÄ±ya dÃ¶ner.","Genel Durum":"CanlÄ±lÄ±k yÃ¼ksek."},"Judgement":{"AÅŸk":"Adil kapanÄ±ÅŸ ikinci ÅŸansÄ± getirir.","Kariyer/Para":"Ã‡aÄŸrÄ±n netleÅŸiyor.","Genel Durum":"YÃ¼zleÅŸme hafifletir."},"The World":{"AÅŸk":"DÃ¶ngÃ¼ tamam; seviye atla.","Kariyer/Para":"Proje kapanÄ±ÅŸÄ±, takdir.","Genel Durum":"BÃ¼tÃ¼nlÃ¼k ve tamamlanma."}};
    const minorTemplates={ "AÅŸk":{Wands:{Ace:"Yeni tutku kÄ±vÄ±lcÄ±mÄ±.",Two:"Birlikte ufka bakÄ±ÅŸ.",Three:"Uzaklardan sevindirici haber.",Four:"Kutlama ve yuva.",Five:"KÃ¼Ã§Ã¼k sÃ¼rtÃ¼ÅŸmelerde ÅŸefkat.",Six:"Takdir edilme.",Seven:"SÄ±nÄ±rlarÄ±nÄ± sevgiyle koru.",Eight:"HÄ±zlÄ± mesajlar.",Nine:"Minik bir mola.",Ten:"YÃ¼kleri paylaÅŸ.",Page:"FlÃ¶rtÃ¶z haberci.",Knight:"Tutkulu giriÅŸim.",Queen:"SÄ±cak Ã§ekim.",King:"KararlÄ± vizyon."},Cups:{Ace:"Kalp kapÄ±sÄ± aÃ§Ä±lÄ±yor.",Two:"KarÅŸÄ±lÄ±klÄ± Ã§ekim.",Three:"PaylaÅŸÄ±lan sevinÃ§.",Four:"Durgunluk, alan aÃ§.",Five:"KÄ±rgÄ±nlÄ±k ÅŸifaya Ã§aÄŸrÄ±lÄ±yor.",Six:"TatlÄ± anÄ±lar.",Seven:"Hayaller Ã§ok; seÃ§.",Eight:"OlgunlaÅŸmak iÃ§in Ã§ekiliÅŸ.",Nine:"Dilek kabulÃ¼.",Ten:"Duygusal bÃ¼tÃ¼nlÃ¼k.",Page:"TatlÄ± mesaj.",Knight:"Romantik teklif.",Queen:"Derin empati.",King:"Olgun sevgi."},Swords:{Ace:"Hakikati konuÅŸ.",Two:"KararsÄ±z gÃ¶nÃ¼l.",Three:"Kalp kÄ±rÄ±ÄŸÄ± ÅŸifasÄ±.",Four:"Dinlendiren sessizlik.",Five:"Ego savaÅŸÄ±ndan uzak dur.",Six:"Sakin sulara geÃ§iÅŸ.",Seven:"DÃ¼rÃ¼stÃ§e konuÅŸ; arÄ±n.",Eight:"KÄ±sÄ±ttan Ã¶zgÃ¼rleÅŸ.",Nine:"Gece abartÄ±r; sabah konuÅŸ.",Ten:"DÃ¶ngÃ¼ kapanÄ±r.",Page:"Nazik merak.",Knight:"Acele sÃ¶z kÄ±rar.",Queen:"Netlik+ÅŸefkat.",King:"SÄ±nÄ±r ve dÃ¼rÃ¼stlÃ¼k."},Pentacles:{Ace:"Somut/istikrarlÄ± teklif.",Two:"Denge oyunu.",Three:"Birlikte inÅŸa.",Four:"GÃ¼ven inÅŸa et.",Five:"Zor gÃ¼nde omuz omuza.",Six:"Vermekâ€“almak.",Seven:"SabÄ±rla bÃ¼yÃ¼r.",Eight:"Ã–zenli emek.",Nine:"Ã–z deÄŸer/zarafet.",Ten:"Uzun vadeli yuva.",Page:"Somut kÃ¼Ã§Ã¼k jest.",Knight:"Sadakatâ€“sÃ¼reklilik.",Queen:"GÃ¼venli liman.",King:"Koruyucu cÃ¶mertlik."}},
      "Kariyer/Para":{Wands:{Ace:"Yeni proje kÄ±vÄ±lcÄ±mÄ±.",Two:"Ufuk/plan.",Three:"Emek dÃ¶nÃ¼ÅŸÃ¼.",Four:"BaÅŸarÄ± kutlamasÄ±.",Five:"Rekabet.",Six:"GÃ¶rÃ¼nÃ¼r baÅŸarÄ±.",Seven:"Pozisyonunu savun.",Eight:"HÄ±zlÄ± sÃ¼reÃ§.",Nine:"Dayan; az kaldÄ±.",Ten:"Delege et.",Page:"Pilot fikir.",Knight:"Atak ama dengeli.",Queen:"Vizyoner liderlik.",King:"Stratejik bÃ¼yÃ¼me."},Cups:{Ace:"Ä°ÅŸe anlam kat.",Two:"OrtaklÄ±k/uyum.",Three:"TakÄ±m ruhu.",Four:"Motivasyonu tazele.",Five:"KayÄ±ptan Ã¶ÄŸren.",Six:"Eski baÄŸlantÄ±.",Seven:"OpsiyonlarÄ± ele.",Eight:"AnlamÄ± azalan iÅŸten uzaklaÅŸ.",Nine:"Dilek projesi olur.",Ten:"Uzun vadeli tatmin.",Page:"Nazik teklif.",Knight:"Ä°liÅŸki yÃ¶netimi.",Queen:"Empatik liderlik.",King:"Duygusal zeka."},Swords:{Ace:"Net karar.",Two:"Veri topla.",Three:"Zor gerÃ§ek.",Four:"Mola/odak.",Five:"Ego savaÅŸÄ±ndan kaÃ§Ä±n.",Six:"Sakin faz.",Seven:"Taktik zekÃ¢; etik.",Eight:"KÄ±sÄ±tÄ± yeniden Ã§erÃ§evele.",Nine:"KaygÄ±ya plan yaz.",Ten:"DÃ¶ngÃ¼ bitti.",Page:"Analitik merak.",Knight:"HÄ±zlÄ± uygulama.",Queen:"Objektif akÄ±l.",King:"SoÄŸukkanlÄ± lider."},Pentacles:{Ace:"Somut fÄ±rsat.",Two:"Nakit/iÅŸ dengesi.",Three:"UstalÄ±k+ekip.",Four:"AÅŸÄ±rÄ± tutma akÄ±ÅŸÄ± boÄŸar.",Five:"GeÃ§ici daralma.",Six:"PaylaÅŸÄ±m/fon.",Seven:"YatÄ±rÄ±m sabÄ±r ister.",Eight:"UstalÄ±k eÄŸrisi.",Nine:"BaÄŸÄ±msÄ±z baÅŸarÄ±.",Ten:"GÃ¼vence/kurumsallÄ±k.",Page:"Staj/Ã¶ÄŸrenme.",Knight:"DÃ¼zenli Ã§alÄ±ÅŸma.",Queen:"Kaynak yÃ¶netimi.",King:"Uzun vadeli finans aklÄ±."}},
      "Genel Durum":{Wands:{Ace:"Yeni enerji.",Two:"YÃ¶n belirleme.",Three:"Emek geri dÃ¶ner.",Four:"Kutlama.",Five:"Ufak Ã§atÄ±ÅŸma; esnek ol.",Six:"Zafer.",Seven:"Pozisyonunu koru.",Eight:"HÄ±zlanma.",Nine:"Pes etme.",Ten:"SadeleÅŸtir.",Page:"Merak/Ã¶ÄŸren.",Knight:"Macera.",Queen:"Karizma.",King:"Vizyonu uygula."},Cups:{Ace:"Kalp tazelenir.",Two:"Uyum.",Three:"Sosyallik.",Four:"Minnet pratiÄŸi.",Five:"Kalan kaynaÄŸÄ± gÃ¶r.",Six:"Masumiyet/anÄ±.",Seven:"SeÃ§enek Ã§ok.",Eight:"Duygusal detoks.",Nine:"Dilek enerjisi.",Ten:"BÃ¼tÃ¼nlÃ¼k.",Page:"Nazik haber.",Knight:"Zarafet.",Queen:"Åžefkatli sezgi.",King:"Olgun duygu."},Swords:{Ace:"Zihinsel netlik.",Two:"Veri topla.",Three:"ArÄ±ndÄ±rÄ±cÄ± yÃ¼zleÅŸme.",Four:"Dinlen/yenilen.",Five:"Gereksiz tartÄ±ÅŸmadan uzak.",Six:"Sakin sular.",Seven:"Zeki plan; etik.",Eight:"KÄ±sÄ±tÄ± Ã§Ã¶z.",Nine:"Eylem planÄ± yaz.",Ten:"DÃ¶ngÃ¼ kapanÄ±r.",Page:"AraÅŸtÄ±r.",Knight:"HÄ±zlÄ± karar.",Queen:"Berrak sÃ¶z.",King:"Kural koy."},Pentacles:{Ace:"Somut baÅŸlangÄ±Ã§.",Two:"Denge.",Three:"Birlikte Ã¼retim.",Four:"GÃ¼venlik ihtiyacÄ±.",Five:"GeÃ§ici sÄ±kÄ±ÅŸma.",Six:"PaylaÅŸÄ±m bereketi.",Seven:"SabÄ±r ve Ã¶lÃ§Ã¼m.",Eight:"Ä°ÅŸÃ§ilik.",Nine:"Konfor/Ã¶zyeter.",Ten:"KalÄ±cÄ±lÄ±k.",Page:"Ã–ÄŸrenme fÄ±rsatÄ±.",Knight:"Rutin gÃ¼Ã§tÃ¼r.",Queen:"Åžefkatli dÃ¼zen.",King:"Uzun vadeli yapÄ±."}}
    };

    function interpret(name,cat,pos,size,user){ const c=cat||"Genel Durum"; const base=getBase(name,c); const p=pos?`${pos} konumunda `:""; if(size==='short') return `${user||'Sevgili danÄ±ÅŸan'}, ${p}${name} diyor ki: ${base} KÃ¼Ã§Ã¼k bir adÄ±m at.`; if(size==='long') return `${user||'Sevgili danÄ±ÅŸan'}, ${p}${name} aÃ§Ä±lÄ±mÄ±n kalbi. ${base} GÃ¶lgede takÄ±lma; netlik ve kÃ¼Ã§Ã¼k adÄ±mlar seni taÅŸÄ±r. RitÃ¼el: Ã¼Ã§ derin nefes + niyet cÃ¼mlesi. Zamanlama: niyet netleÅŸince hÄ±zlanÄ±r.`; return `${user||'Sevgili danÄ±ÅŸan'}, ${p}${name} ÅŸunu vurguluyor: ${base} Denge, aÃ§Ä±k iletiÅŸim ve somut kÃ¼Ã§Ã¼k adÄ±m.`; }
    function getBase(card,cat){ if(majorMap[card]) return majorMap[card][cat]||majorMap[card]["Genel Durum"]; const m=card.match(/^(Ace|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|Page|Knight|Queen|King) of (Wands|Cups|Swords|Pentacles)$/); if(m){ const r=m[1],s=m[2]; return (minorTemplates[cat]&&minorTemplates[cat][s]&&minorTemplates[cat][s][r])?minorTemplates[cat][s][r]:minorTemplates["Genel Durum"][s][r]; } return "Denge ve farkÄ±ndalÄ±k Ã§aÄŸrÄ±sÄ±."; }

    function buildDecks(mode){ const shuffled=shuffle(ALL_CARDS.map(c=>c.id)); let decksCount=6,size=13; if(mode==='cross'){decksCount=3;size=26} const decks=[]; let i=0; for(let d=0; d<decksCount; d++){ decks.push(shuffled.slice(i,i+size)); i+=size; } return {count:decksCount,size,decks}; }
    function reqCount(m){ if(m==='one')return 1; if(m==='three')return 3; if(m==='five')return 5; if(m==='cross')return 10; if(m==='relationship')return 7; return 1; }
    function shuffle(a){ a=[...a]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
    function esc(s=''){ return s.replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }
    function resetAll(){ state.name=''; state.mode=null; state.category=null; state.yesnoQuestion=''; state.decksMeta=null; state.chosenDeckIndex=null; state.selectedCards=[]; state.needSelect=0; state.commentSize='medium'; }
  })();
  </script>
</body>
</html>
